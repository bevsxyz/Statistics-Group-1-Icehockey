---
title: Statistics Group 1 Project Proposal
subtitle: Ice Hockey
date: 30 September 2023
author:
  - name: Bevan Stanely
    id: bs
    email: h20230860@pilani.bits-pilani.ac.in
  - name: Nikhil Verma
    id: nv
  - name: Shantanu Sengupta
    id: ss
  - name: Abhishek Kumar
    id: ak
  - name: Gubbala Hari Priya
    id: hp
  - name: Lakshay Sharma
    id: ls
  - name: Sunku Vydehi
    id: sv
format:
  docx:
    toc: true
    toc-title: Table of Contents
    standalone: true
    number-sections: true
    highlight-style: atom-one
  pdf:
    pdf-engine: pdfroff
citation: true
link-citations: true
bibliography: ref.bib
---

{{< pagebreak >}}

# Executive Summary

Ice hockey is a fast-paced team sport renowned for its combination of speed, physicality, and skill, predominantly played in cold-weather nations like Canada, the USA, Russia, Sweden, and Finland. Women's ice hockey, a variant of the sport played exclusively by female athletes, shares similarities with men's hockey but boasts its distinct history. Since 1990, the International Ice Hockey Federation (IIHF) has organized the IIHF World Women's Championship, showcasing the growth of women's ice hockey.Â 

The USA took the championship in the current year, with Canada coming in second. Since the inception of the competition, they have been regularly among the winners. The first eight championships were won by Canada, whereas the United States dominated in the more recent editions, taking home ten out of the last 14 championships[@WomenWorldChampionship].

The main objective in ice hockey is to score goals by shooting a puck into the opposing team's net. A standard game comprises three periods, each lasting 20 minutes, with intermissions for player rest and ice maintenance. Victory goes to the team with the most goals after these three periods.

In a typical lineup, each team fields six players simultaneously on the ice, featuring a goaltender (goalie) and five skaters. These skaters are typically divided into three forwards (left wing, center, and right wing) and two defensemen.

To maintain fairness and uphold the competitive spirit of the game, ice hockey employs an extensive set of rules and penalties. Players who commit infractions can be temporarily sidelined in the penalty box, leading to power plays (when one team has more players on the ice) or penalty kills (when a team is shorthanded). These regulations play a crucial role in preserving the integrity of the sport.

Our analysis involves the single-year data of the 2023 IIHF World Women's Championship. We will address the individual player performance with linear regression and identify the key attributes affecting the performance.

![[@BasicIceHockey]](img/Ice_hockey_layout.jpg){width="500"}

# **Problem Statement**

## **What are the critical factors predicting a player's performance?**

The challenge is to systematically identify and analyze the key factors that reliably predict a player's performance. This includes analyzing the physical, skill-based, psychological, and strategic elements [@niggDemographicPhysiologicalPsychological2020] that contribute to a player's effectiveness in the game. There is a need for a framework that allows coaches, teams, and players to make data-driven decisions and improve the overall competitive edge in the sport.

For this study, we only looked at the official data on the physical and game statistics of 203 forwards and defenders. The rationale behind the decision to exclude goalies from our dataset stems from the disparity in their performance metrics with forwards and defenders.

In women's ice hockey, the publicly available data is limited in terms of how important the attribute is for the players' performance. Furthermore, there is currently no tidy dataset available. So, we are collecting and putting together information from official documents and extending it. We also want to look at the player statistics of the participants in the 2023 Women's Ice Hockey World Championship and identify the key performance indicators for high-performing players.

{{< pagebreak >}}

# **Proposed Solution**

We will compile a tidy dataset using publicly available data from the 2023 Women's Ice Hockey World Championship. Furthermore, we will perform regression analysis to identify the dependence of the individual variables on the player's performance. We expect to derive critical insights that could have implications for team strategizing. The insights will also help ice hockey fans understand their favorite players better.

The attributes of the data[^1] collected are as follows

[^1]: The dataset is provided in [data.csv](data.csv)

|     |                             |                                                                                                                |
|------------------|---------------------------|---------------------------|
| No. | Attribute                   | Description                                                                                                    |
|     | **Dependent variable**      |                                                                                                                |
| 1   | Points/Game                 | Average of points scored across all the games played.                                                          |
|     | **Independent variables**   |                                                                                                                |
| 2   | Position                    | Player-position: Forwards or Defensemen (Goalies are ignored since their performance metrics are different)    |
| 3   | Goals                       |                                                                                                                |
| 4   | Assist                      | Goals that were assisted by focal player                                                                       |
| 5   | Country                     | Team played under                                                                                              |
| 6   | Games played                | Total games played by the player in the current season.                                                        |
| 7   | Height                      | In cms                                                                                                         |
| 8   | Weight                      | In Kg                                                                                                          |
| 9   | Penalties in minutes        | Penalty duration over the championship                                                                         |
| 10  | +/- Plus/minus              | Player's goal differential while they are on the ice                                                           |
| 11  | Shots on goal(SOG)          | The number of attempts made by a player to score a goal that directly challenge the opposing team's goaltender |
| 12  | Age                         |                                                                                                                |
| 13  | Shoots (left or right)      | Player handedness                                                                                              |
| 14  | Total minutes/s played (TM) | Total player time on ice                                                                                       |

Our choice of points for the dependent variable covers a player's ability to score and the team spirit assisting their teammates in scoring. As a game, hockey uses points for ranking purposes, reinforcing our choice. The remaining independent variables were picked from the player parameters available.

## Variable Significance

We can group the things that affect how a player plays a game into different categories.

### Individual Characteristics

The individual player possesses distinct characteristics such as height, weight, age, position, and player handedness (shooting). Since they could affect individual performance, they would be useful for our model.

### Performance Characteristics

Resulting from the players' participation in the championship are variables pertaining to the outcome of their participation. Goals, assists, games played, penalties in minutes, +/- differential, shots on goals, and total minutes played are performance variables. The average of total goals scored with assists is our dependent variable. The remaining variables indicate how the players' time on the ice was spent.

Finally, the variable country groups the players with their teammates. Ice hockey being a team sport, the player's performance is linked to their teammates. Therefore, we could use it to assess the player performance distribution within the team.

We will use the following data sources for the data.

| Sr. no. | Data                                                 |
|---------|------------------------------------------------------|
| 1       | Quant hockey Website [-@IIHFWorldChampionship]       |
| 2       | IIHF Official Website [-@WomenWorldChampionship]     |
| 3       | Team USA [-@USAPlayerStatistics2023]                 |
| 4       | Team Japan [-@JapanPlayerStatistics2023]             |
| 5       | Team Canada [-@CanadaPlayerStatistics2023]           |
| 6       | Team Switzerland [-@SwitzerlandPlayerStatistics2023] |
| 7       | Team Czech Republic [-@CzechiaPlayerStatistics2023]  |
| 8       | Team France [-@FrancePlayerStatistics2023]           |
| 9       | Team Finland [-@FinlandPlayerStatistics2023]         |
| 10      | Team Germany [-@GermanyPlayerStatistics2023]         |
| 11      | Team Sweden [-@SwedenPlayerStatistics2023]           |
| 12      | Team Hungary [-@HungaryPlayerStatistics2023]         |

## Limitations

We foresee two limitations of the dataset, which should be accounted for in the analysis.

1.  Small sample size compared to other tournaments

2.  The tournament had two parts. 1st part was a group stage and 2nd a knockout competition, giving more match time and the opportunity to score more points for qualified teams.

{{< pagebreak >}}

# Timeline

The anticipated time frame for the project tasks is as follows.

|                          |                    |
|--------------------------|--------------------|
| Task                     | Due Date           |
| Finalize Data Collection | 5th September 2023 |
| Mid Term Review          | 3rd October 2023   |
| Final Submission         | 29th November 2023 |

{{< pagebreak >}}

# Analysis

## Exploratory Data Analysis

In this section, we conduct an exploratory data analysis (EDA) to understand the distribution and relationships within our dataset. Our dependent variable of interest is "Points per Game" (avg_points), and we aim to identify key factors influencing this variable.

```{r}
#| echo: false
#| warning: false
# Load tidyverse and read data
library(tidyverse)
library(knitr)
library(coefplot)
# Read and tidy data
df = read_csv("data.csv")
```

To get an idea of our data, we will check the data type of the variables.

```{r}
#| label: tbl-datatypes
#| tbl-cap: The count of different data types read.
df |> map_chr(type_sum) |>
  as_tibble_row() |>
  pivot_longer(everything()) |>
  count(value) |> kable()
```

\
The data set includes four categorical variables, eleven numerical variables, and a unique time-varying variable. The time variable is converted into seconds. Furthermore, we will also eliminate variables related to the dependent variable to avoid overfitting the linear model to the data.

```{r}
# Drop since they are related to the dependent variable
df = df |> select(!c(games_played_gp,goals_g, assists_a, points))
# Convert duration to seconds
df = df |>  mutate(total_minutes_as_duration =
                     as.numeric(total_minutes_as_duration, unit = "secs")) |>
  # Rename some columns for easier analysis
  rename(
    avg_points = points_per_game_ppg,
    penalty_dur = penalties_in_minutes_pim,
    duration = total_minutes_as_duration,
    g_diff = plus_minus_goal_differential,
    sog = shots_on_goal_sog
  )
```

Subsequently, we generate a statistical summary of all variables to examine their distribution.

```{r}
#| label: tbl-stat-summary
#| echo: false
#| tbl-cap: "Statistical Summary of Numerical Columns"
#| tbl-colwidths: [60,40]
df |> summarise(across(
  where(is.numeric),
  .names = "{.col}-{.fn}",
  .fns = list(
    min = min,
    median = median,
    mean = mean,
    stdev = sd,
    q25 =  ~ quantile(., 0.25),
    q75 =  ~ quantile(., .75),
    max = max
  )
)) |>
  pivot_longer(everything(),
               names_sep = '-',
               names_to = c('variable', '.value')) |> 
  kable()
```

```{r}
#| label: corr-functions
#| echo: false
# Calculate correlation matrix
df.corr <- function(df) {
  df = df |>  select(where(is.numeric)) |>  cor()
  mrows <<- rownames(df)
  # Convert the matrix output to tibble dataframe
  
  df = df |>
    as_tibble(rownames = "var_1") |>
    gather(key = "var_2", value =
             "cor",-1) |> drop_na()
  return(df)
}
# Correlation Plotting Function
plot.corr <- function(df){
  # Plot correlation heatmap
  ggplot(df.corr(df), aes(var_1, var_2, fill = cor, label = round(cor, 2))) +
    theme(axis.text.x = element_text(
      angle = 90,
      vjust = 0.5,
      hjust = 1
    ),
    axis.title = element_blank(),
    ) +
    geom_tile() + ylim(mrows) + xlim(rev(mrows)) +
    geom_text(color = "white") +
    labs(fill = "Correlation")
}
```

```{r}
#| label: corr-1
#| fig-width: 8
#| fig-height: 8
#| fig-cap: "Correlation Matrix of all the Variables"
plot.corr(df)
```

The relationships between the variables are reflected in the correlation matrix. It is evident that there are no independent variable pairs with an absolute correlation greater than 0.7. Therefore, we can proceed with our features because of the absence of multicollinearity.

We will now explore the DV-IV relationships in greater detail. In the XY scatter plot of the dependent variable with each independent variable, we use smoothing to find the best curve. This would enable us to conduct a visual analysis of the linearity of the relationship.

```{r}
#| label: fig-scatter-1
#| fig-cap: "The figure shows the relationship between the each numeric independent variable with the dependent variable average points."
#| fig-width: 10
#| fig-height: 10
#| warning: false
df |> select(where(is.numeric)) |>
  gather(yvar, val,-avg_points) |>
  ggplot(aes(val, avg_points)) +
  geom_point() +
  stat_smooth(geom = "smooth") +
  facet_wrap(yvar ~ ., ncol = 2, scales = "free_x") +
  labs(x = "Numeric Independent Variables", y = "Average Points(IV)", title =
         "IV vs DV Scatter Plot")
```

All variables, except duration, have an approximately linear relationship with average points. The occurrence of an outlier in the duration results in a significant deviation from linearity. After further investigation, we conclude that the anomaly is the result of human error in data collection.

```{r}
#| label: tbl-outlier
df |> select(Name, country, duration) |>
  filter(duration == max(duration)) |>
  kable()
```

To address the anomaly, we rectify the duration for Emma Ingold and reassess the linear correlation between the duration and the dependent variable.

```{r}
#| label: fig-replace-outlier
#| fig-cap: Duration vs Average Points scatter plot after replacing the outlier.
df = df |> mutate(duration = replace(duration,
                                     Name == "Emma Ingold",
                                     as.numeric(
                                       as.difftime("01:30:24",
                                                   format = "%H:%M:%S",
                                                   units = "secs")
                                     )))
df |> select(avg_points, duration) |>
  ggplot(aes(duration, avg_points)) +
  geom_point() +
  stat_smooth(geom = "smooth") +
  labs(x="Total Player time in Seconds", y="Average Points(DV)")
```

After fixing the outlier in the duration variable, the linear relationship becomes more apparent.

Data quality and consistency are ensured by a final check of the correlation matrix and box plots.

```{r}
#| label: fig-corr-2
#| fig-width: 8
#| fig-height: 8
#| fig-cap: "Correlation Matrix after fixing the outlier"
# Plot correlation heatmap
plot.corr(df)
```

We can see that fixing the outlier increased the correlation between the duration and average points from 0.09 to 0.53. This increase may prove advantageous to our modeling efforts.

```{r}
#| label: fig-boxplot-1
#| fig-cap: "The figure illustrates the connection between the categorical independent variables and the dependent variable's average points via box plots. Of the three IVs, country, position, and shoot, country seems to be the most informative."
#| fig-width: 15
#| fig-height: 10
#| warning: false
df |> select(-where(is.numeric), -Name, avg_points) |>
  gather(yvar, val,-avg_points) |>
  ggplot(aes(reorder(val, avg_points), avg_points, fill = val)) +
  geom_boxplot() +
  facet_wrap(yvar ~ ., ncol = 2, scales = "free_x") +
  theme(legend.position = "none") +
  labs(x = "Categorical Independent Variables", y = "Average Points(IV)", title =
         "IV vs DV Box Plot")
```

The data appears to be in a satisfactory state, and we can proceed with the construction of a regression model.

## Regression Analysis

We start by making a model without any data. Then, we choose one that has all the IVs we are studying now\[1\]. Also, we will make two models: one that doesn't have categories\[2\] and another that looks at how IVs interact with each other\[3\]. In the latter scenario, we shall consider all pairwise interactions and second-order terms.

```{r}
#| label: mlr
nullModel = lm(avg_points ~ 1, data=df)
# the largest model we will accept
fullModel = lm(avg_points ~.,data=df |> select(-Name)) # All variables
fullModel1 = lm(avg_points ~.-position-country-shoot,data=df |> select(-Name)) # All numeric variables
fullModel2 = lm(avg_points ~.^2,data=df |> select(-Name)) # All variables with all combinations of interaction
```

We will utilize a vector function to iterate through the models. A stepwise regression strategy that uses both forward selection and backward elimination will be used.

```{r}
#| output: false
#| warning: false
model = lapply(list(fullModel, fullModel1, fullModel2), function(x)
  step(
    x,
    scope = list(lower = nullModel, upper = x),
    direction = "both"
  ))
```

```{r}
#| label: model-summary
model_residual = lapply(model,fortify)
lapply(model,function(x)x$call)
```

The interaction model has too many variables, according to the model equations. It is difficult to visualize such a model. Therefore, we will only graph the coefficients of the other two models..

```{r}
multiplot(model[1:2])
```

```{r}
lapply(model[1:2], function(x)summary(x))
```

Following the model fitting, we assess the residuals for model validation.

```{r}
#| label: fig-residual-plot
#| fig-cap: The scatter plots of the residual vs. fitted value for the three models. There is heteroscedasticity in all three figures
#| warning: false
#| fig-width: 10
#| fig-height: 10

m.res = lapply(model_residual, function(x) x |> select(.fitted, .stdresid))
model_residual_final = m.res[[1]] |> mutate(model=1) |> add_row(m.res[[2]] |> mutate(model=2)) |> add_row(m.res[[3]] |> mutate(model=3))
model_residual_final |>
  ggplot(aes(x = .fitted, y = .stdresid)) +
  geom_point() +
  geom_hline(yintercept = 0) +
  stat_smooth(geom = "smooth") +
  labs(x = "Fitted Values", y = "Residuals", color="Country") +
  facet_wrap(model~.,ncol = 1 )
```

```{r}
#| label: fig-redsidual-facet
#| warning: false
#| fig-width: 10
#| fig-height: 10
model_residual[[1]] |>
  ggplot(aes(x = .fitted, y = .resid)) +
  geom_point() +
  geom_hline(yintercept = 0) +
  geom_smooth(se = FALSE) +
  labs(x = "Fitted Values", y = "Residuals") +
  facet_wrap(. ~country, scales = "free_x", ncol = 3)
```

The residual analysis ensures that the model assumptions are met. Additionally, we check the normality of residuals using a QQ plot.

```{r}
#| label: fig-qq-facet
#| warning: false
#| fig-width: 10
#| fig-height: 10
model_residual_final |> 
  ggplot(aes(sample=.stdresid)) +
  stat_qq() +
  geom_abline() +
  facet_wrap(model~.,ncol = 2 )
```

The QQ plot confirms the normal distribution of residuals. The regression analysis provides insights into the relationships between variables and their impact on average points in women's ice hockey

```{r}
#| label: tbl-spcor
ppcor::spcor(df |> select_if(is.numeric), method = "pearson")$estimate |>
  as_tibble(rownames="rowname") |> 
  filter(rowname == "avg_points") |>  select("g_diff","sog","duration") |> kable()
```

# References
